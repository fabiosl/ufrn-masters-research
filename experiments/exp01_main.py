import random
import string
import time
# import mysql_config
import urllib2

NUMBER_OF_ATTEMPTS_FOR_EACH_QUERY_LENGTH = 10


fb_cursor = mysql_config.mysql_connection.cursor() 


def get_random_string_with_size(query_length):
    return ''.join(random.SystemRandom().choice(string.ascii_uppercase + string.digits) for _ in range(query_length))



def search_time_mysql(query_string):
    query_size = len(query_string)
    query_string = ''' "% ''' + query_string + '''% " '''
    start_time = time.time()
    fb_cursor.execute('SELECT COUNT(*) FROM mestrado.post_all_pages_portugal_globo_pt WHERE message like %s' % query_string)
    end_time =  time.time() - start_time
    return end_time


def search_time_elasticsearch(query_string):
    query_size = len(query_string)
    url = mysql_config.elasticsearch_url + "q=message:%s" % query_string
    start_time = time.time()
    urllib2.urlopen(url).read()
    end_time =  time.time() - start_time
    return end_time

mysql_queries = []
elasticsearch_queries = []
for query_length in [250, 150, 100, 50, 30, 20, 10, 5, 2]:
    for attempt in range(NUMBER_OF_ATTEMPTS_FOR_EACH_QUERY_LENGTH):
        query_string = get_random_string_with_size(query_length)
        
        mysql_queries.append((query_length,search_time_mysql(query_string)))
        elasticsearch_queries.append((query_length,search_time_elasticsearch(query_string)))
        print "MySQL Queries: %s" % mysql_queries
        print "ES Queries: %s" % elasticsearch_queries


#Exp 01 - Result
# Fulltextsearch 10 times on message field for each query string. Sizes: [250, 150, 100, 50, 30, 20, 10, 5, 2]

# mysql = [(250, 8.573455095291138), (250, 8.677120923995972), (250,
# 8.47842001914978), (250, 8.490628004074097), (250, 8.600229978561401), (250,
# 8.559010028839111), (250, 8.564481019973755), (250, 8.683254957199097),
# (250, 8.480591058731079), (250, 8.490480899810791), (150,
# 8.505867004394531), (150, 8.533949136734009), (150, 8.635606050491333),
# (150, 8.60778284072876), (150, 8.500662088394165), (150, 8.557183980941772),
# (150, 8.533016920089722), (150, 8.715044975280762), (150,
# 8.494284868240356), (150, 8.505952835083008), (100, 8.534701824188232),
# (100, 8.590558052062988), (100, 8.592019081115723), (100,
# 8.563470125198364), (100, 8.544020891189575), (100, 8.579228162765503),
# (100, 8.574074983596802), (100, 8.568406105041504), (100,
# 8.633325099945068), (100, 8.58201813697815), (50, 8.627624988555908), (50,
# 8.587389945983887), (50, 8.6981840133667), (50, 8.643903970718384), (50,
# 8.591493129730225), (50, 8.596834897994995), (50, 8.717957973480225), (50,
# 8.58911395072937), (50, 8.571476936340332), (50, 8.55764102935791), (30,
# 8.601639032363892), (30, 8.610876083374023), (30, 8.551656007766724), (30,
# 8.664033889770508), (30, 8.6490478515625), (30, 8.734318017959595), (30,
# 8.576434135437012), (30, 8.685302019119263), (30, 8.582315921783447), (30,
# 8.601229906082153), (20, 8.562317132949829), (20, 8.652375936508179), (20,
# 8.678266048431396), (20, 8.55340313911438), (20, 8.56910514831543), (20,
# 8.595579862594604), (20, 8.6785249710083), (20, 8.584181070327759), (20,
# 8.692536115646362), (20, 8.600940942764282), (10, 8.567659139633179), (10,
# 8.723396062850952), (10, 8.655622959136963), (10, 8.661460876464844), (10,
# 8.596783876419067), (10, 8.574450969696045), (10, 8.597405195236206), (10,
# 8.59629201889038), (10, 8.583148002624512), (10, 8.625458002090454), (5,
# 8.578196048736572), (5, 8.594217777252197), (5, 8.564470052719116), (5,
# 8.553457021713257), (5, 8.525596857070923), (5, 8.526775121688843), (5,
# 8.680750846862793), (5, 8.553147077560425), (5, 8.692341804504395), (5,
# 8.581300020217896), (2, 8.714314937591553), (2, 8.59768795967102), (2,
# 8.565704107284546), (2, 8.560765027999878), (2, 8.646732091903687), (2,
# 8.568054914474487), (2, 8.555607080459595), (2, 8.618880987167358), (2,
# 8.645883083343506), (2, 8.63663911819458)]
# es = [(250, 0.43065500259399414), (250, 0.40747809410095215), (250,
# 0.36101293563842773), (250, 0.3788769245147705), (250, 0.4411170482635498),
# (250, 0.6139910221099854), (250, 0.42267489433288574), (250,
# 0.37485313415527344), (250, 0.3541531562805176), (250, 0.3842339515686035),
# (150, 0.3325510025024414), (150, 0.39231300354003906), (150,
# 0.4199099540710449), (150, 0.390916109085083), (150, 0.3384859561920166),
# (150, 0.3374330997467041), (150, 0.3951389789581299), (150,
# 0.42847394943237305), (150, 0.4833099842071533), (150, 0.3586080074310303), (100, 0.3943929672241211), (100, 0.40724992752075195), (100,
# 0.3462538719177246), (100, 0.3346428871154785), (100, 0.43050384521484375),
# (100, 0.4134697914123535), (100, 0.4338188171386719), (100,
# 0.3653891086578369), (100, 0.33094096183776855), (100, 0.38504815101623535),
# (50, 0.44850993156433105), (50, 0.3396899700164795), (50,
# 0.3701901435852051), (50, 0.3674328327178955), (50, 0.4445221424102783),
# (50, 0.3741779327392578), (50, 0.4274778366088867), (50,
# 0.3832859992980957), (50, 0.3797440528869629), (50, 0.4020869731903076),
# (30, 0.37537097930908203), (30, 0.36900997161865234), (30,
# 0.3769559860229492), (30, 0.33519506454467773), (30, 0.38521599769592285),
# (30, 0.42802000045776367), (30, 0.4577009677886963), (30,
# 0.3986480236053467), (30, 0.36842918395996094), (30, 0.44573283195495605),
# (20, 0.4358510971069336), (20, 0.388671875), (20, 0.37035512924194336), (20,
# 0.3593919277191162), (20, 0.3635368347167969), (20, 0.37296295166015625),
# (20, 0.41257786750793457), (20, 0.5117189884185791), (20,
# 0.37961506843566895), (20, 0.3877279758453369), (10, 0.38820695877075195),
# (10, 0.3823859691619873), (10, 0.4562520980834961), (10,
# 0.40308713912963867), (10, 0.3940548896789551), (10, 0.3303849697113037),
# (10, 0.4128589630126953), (10, 0.33147382736206055), (10,
# 0.40210485458374023), (10, 0.3432338237762451), (5, 0.34072113037109375),
# (5, 0.32900500297546387), (5, 0.44123315811157227), (5, 0.3693699836730957),
# (5, 0.3318309783935547), (5, 0.35691404342651367), (5, 0.42060184478759766),
# (5, 0.33368992805480957), (5, 0.5576040744781494), (5, 0.3419358730316162),
# (2, 0.3507571220397949), (2, 0.35616302490234375), (2, 0.3557279109954834),
# (2, 0.41585493087768555), (2, 0.40979719161987305), (2,
# 0.38869404792785645), (2, 0.3747849464416504), (2, 0.3908970355987549), (2,
# 0.36167001724243164), (2, 0.3972451686859131)]